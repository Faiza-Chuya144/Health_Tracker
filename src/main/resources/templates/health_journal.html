<!-- health_journal.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Health Journal</title>
    <link rel="stylesheet" th:href="@{/css/health_journal.css}" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
</head>
<body>
<div class="container">
    <!-- Sidebar -->
    <aside class="sidebar w-64 bg-white text-gray-800 flex flex-col p-4 fixed h-full overflow-y-auto">
        <h2 class="sidebar-title text-2xl font-bold mb-6 flex items-center justify-center">
            <i class="fas fa-heartbeat mr-2 text-blue-600"></i> HealthPulse
        </h2>
        <nav class="sidebar-nav flex flex-col space-y-2">
            <a th:href="@{/user/dashboard}" class="nav-item flex items-center p-3 rounded-lg hover:bg-blue-50 transition-colors duration-200 text-gray-700">
                <i class="fas fa-th-large mr-3 text-gray-500"></i> Dashboard
            </a>
            <a th:href="@{/health-journal}" class="nav-item flex items-center p-3 rounded-lg hover:bg-blue-50 transition-colors duration-200 text-gray-700">
                <i class="fas fa-clipboard-list mr-3 text-gray-500"></i> Health Journal
            </a>
            <a th:href="@{/health_prediction}" class="nav-item flex items-center p-3 rounded-lg hover:bg-blue-50 transition-colors duration-200 text-gray-700">
                <i class="fas fa-chart-line mr-3 text-gray-500"></i> AI Prediction
            </a>
            <a th:href="@{/food_scanner}" class="nav-item flex items-center p-3 rounded-lg hover:bg-blue-50 transition-colors duration-200 text-gray-700">
                <i class="fas fa-apple-alt mr-3 text-gray-500"></i> Food Scanner
            </a>
            <a th:href="@{/user/book_appointment}" class="nav-item active flex items-center p-3 rounded-lg bg-blue-100 text-blue-700 font-semibold">
                <i class="fas fa-calendar-alt mr-3 text-blue-700"></i> Book Appointment
            </a>
        </nav>
        <form th:action="@{/logout}" method="post" class="logout-form mt-auto">
            <button type="submit" class="w-full flex items-center justify-center p-3 rounded-lg bg-red-500 hover:bg-red-600 text-white font-semibold transition-colors duration-200">
                <i class="fas fa-sign-out-alt mr-2"></i> Logout
            </button>
        </form>
    </aside>
    <!-- Main Content -->
    <main class="main-content">
        <h2>Your Health Journal</h2>

        <div class="error" th:if="${error}" th:text="${error}"></div>

        <!-- Add/Update Form -->
        <form th:action="@{/health-journal/save}" method="post" th:object="${healthJournal}" class="journal-form">
            <input type="hidden" th:field="*{id}" />
            <input type="hidden" th:field="*{userName}" />

            <div class="form-grid">
                <div class="left-panel">
                    <label for="entryDate">Entry Date:</label>
                    <input id="entryDate" type="date"
                           th:field="*{entryDate}"
                           th:attr="min=${#dates.format(#dates.createNow(), 'yyyy-MM-dd')}"
                           required />
                    <label for="age">Age:</label>
                    <input id="age" type="number" th:field="*{age}" required />

                    <label for="weight">Weight (kg):</label>
                    <input id="weight" type="number" step="0.1" th:field="*{weight}" required />

                    <label for="height">Height (cm):</label>
                    <input id="height" type="number" step="0.1" th:field="*{height}" required />

                    <label for="bmi">BMI:</label>
                    <input id="bmi" type="number" step="0.1" th:field="*{bmi}" readonly />
                </div>

                <div class="right-panel">
                    <h3>Health Issues</h3>
                    <div class="health-issues">
                        <div class="issue" th:each="entry : ${issueList}">
                            <label th:for="${entry.key}" th:text="${entry.key}"></label>
                            <input type="text"
                                   th:id="${entry.key}"
                                   th:name="'healthIssues[' + ${entry.key} + ']'"
                                   th:value="${healthJournal.healthIssues != null ? healthJournal.healthIssues[entry.key] : ''}" />
                        </div>
                    </div>
                </div>
            </div>

            <div class="button-group save-button">
                <button type="submit" class="btn btn-save" th:text="${healthJournal.id != null} ? 'üîÑ Update' : 'üíæ Save'"></button>
            </div>
        </form>

        <hr />

        <!-- Journal Summary Table -->
        <h3>Your Journal Summary</h3>
        <table class="summary-table">
            <thead>
            <tr>
                <th>Entry Date</th>
                <th>Age</th>
                <th>Height (cm)</th>
                <th>Weight (kg)</th>
                <th>BMI</th>
                <th>Health Issues</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="entry : ${journalList}">
                <td th:text="${entry.entryDate}">--</td>
                <td th:text="${entry.age}">0</td>
                <td th:text="${entry.height}">0</td>
                <td th:text="${entry.weight}">0</td>
                <td th:text="${entry.bmi}">0</td>
                <td>
                    <ul>
                        <li th:each="issue : ${entry.healthIssues.entrySet()}"
                            th:if="${issue.value != null and !#strings.isEmpty(issue.value)}"
                            th:text="${issue.key + ': ' + issue.value}"></li>
                        <li th:if="${entry.healthIssues == null or #lists.isEmpty(entry.healthIssues.entrySet())}">
                            No issues recorded.
                        </li>
                    </ul>
                </td>
                <td>
                    <!-- Update button: loads entry into form -->
                    <a th:href="@{/health-journal/select(entryDate=${entry.entryDate})}" class="btn btn-select">‚úèÔ∏è Update</a>

                    <!-- Delete -->
                    <form th:action="@{/health-journal/delete}" method="post" onsubmit="return confirm('Are you sure?');" style="display:inline;">
                        <input type="hidden" name="userName" th:value="${entry.userName}" />
                        <input type="hidden" name="entryDate" th:value="${entry.entryDate}" />
                        <button type="submit" class="btn btn-delete">üóëÔ∏è Delete</button>
                    </form>
                </td>
            </tr>
            </tbody>
        </table>
    </main>
</div>
</body>
</html>
